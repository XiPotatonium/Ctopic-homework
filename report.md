# 实验报告（纯文字版）

题目：图书管理系统

组号：201818

成员：  
3170101509-钟嘉农  
3170101508-邬树辉

提交人：  
联系电话：  
Email:

任课教师：肖少拥

递交日期：2018/4/


## 1. 程序简介

LibMan为一款便捷、轻量级、安全的命令行图书管理系统，除了图书增、删、改、查找等操作外，还提供了加密功能，有效保护文件不被窃取、篡改。  
图书的信息包括书名，书号，作者，出版社，关键词，出版日期。  
程序的设计思想是录入的图书都应该有一个独一无二的书号，虽然录入重复的书号并不会报错，但是在删除、修改等操作上会出现问题。图书管理员应该设计合理的图书编号方式避免图书使用同样的书号。

## 2. 使用说明
 * 设置密码
 * 添加记录  
输入`add`可以循环添加记录，如果在输入书名的时候直接回车那么就会终止输入，把之前输入的信息加入记录中。
 * 删除记录  
输入`del`可以删除记录，目前只支持`-id`参数，通过id来确定图书。如果id不存在那么什么也不会做。
 * 修改记录  
输入`modify`可以修改图书记录，目前只支持`-id`参数，重新输一遍图书信息，而后更新记录。
 * 查找记录  
输入`search`可以查找记录，支持`-name`、`-author`、`-key`、`-all`这几个参数，分别是在书名中精确匹配，在作者中查找字串，在关键词中查找字串，在书名、作者、关键词中查找子字串。注：查找子串使用strstr查看搜索关键字是否是书的信息的一个字串，如果是，就打印这本书的信息。这样的功能设计是仿照浙大图书馆微信公众号的查询功能。
 * 导出文件  
输入`export`可以将图书导出到一个文本文件中，目前支持`-all`，即将记录中所有的图书信息导出到一个文件中（默认导出到同目录下out.txt）。
 * 导入文件  
未完成。目前只能从文件读入内存，并没有写入数据文件的功能。可以在libman.c的246行，将`#if 0`改成`#if 1`，编译后输入import out.txt可以体验读入内存。注：out.txt是要导入的文件的文件名。原则上，只应该导入上面export生成的文件，因为随便写的文件会导致格式错误。程序会判断文件第二行是否有“Books exported from libman”，如果有则认为是export生成的，进行导入，如果没有，就终止导入。
 * 命令帮助
输入`help`会输出帮助文档，包括程序支持的所有命令和它们的参数。

## 3. 文件说明

### __libman.h libman.c__
主程序代码，定义了所有与图书有关的操作，且实现了交互式的命令行，支持各种指令。

### __main.c__
int main()所在的文件，调用libman的交互式命令行。

### __aes256.h aes256.c__
提供了AES256加密算法的函数，在他人现有的源码进行了一定程度的封装，方便调用。

### __libman.db__
存储图书的数据文件。  

## 4. 主要算法说明  

### __加密存储__  
为了实现安全的目标，LibMan中引入了基于AES256算法的加密存储。每个Book结构体被复制到512B的空间上进行加密，再写入文件。加密对于文件被篡改是无能为力的，只能保证文件不被恶意读取，因此LibMan并不检查密码的正确性，当输入的密码错误时，仍然可以打开文件，但是得到的是解密错误带来的乱码。值得一提的是，Book结构体的实际大小小于512B，使用512B的目的是提供向前兼容性，并使其在内存或硬盘中对齐。
### __散列和链表__  
考虑到LibMan中只有书名是精确查找，而且用户大多数情况下是用书名作为关键字进行搜索，所以我们用书名的首字母来生成散列表，这样可以极大地加快搜索的效率。每一个散列“桶”都用一个链表来储存节点。这个链表是有哨兵的双向循环链表。说明：哨兵节点是连接链表头和链表尾的一个不储存图书信息的节点，这样在插入或者删除节点的时候完全不用考虑在链表头和在链表尾插入删除这样的边界情况，代码可以比较简洁，紧凑。这个链表是根据书名排了序的，所以在搜索的时候遇到节点书名大于目标书名的时候就可以终止搜索。  

## 5. 优缺点  
 * 土制cmd是坠吼的！LibMan使用自制的命令行交互功能，非常符合控制台程序的风格。LibMan支持很多命令，功能参照浙大图书馆微信成熟的图书查询系统，基本覆盖了图书管理系统的常见操作。还支持命令防手抖功能，如果输入命令不正确或不完全LibMan会猜测可能的命令。
 * 完善的程序注释，每一个自定义函数在函数声明的地方都有函数注释说明，在函数的关键步骤中也有一定的注释。
 * 安全性